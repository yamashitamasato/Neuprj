<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Neu game|Recruitment</title>
  </head>
  <body>
    <h2>ユーザーを募集しています</h2>
    <h2 id='userID'>ID:</h2>
    <p id="usercount">現在の参加者数:</p>
    <button onclick="gamestart();">開始する。</button>
    <div id="msg"></div>
  </body>
</html>
<script src="/socket.io/socket.io.js"></script>
<script type="text/javascript">
  // 1.イベントとコールバックの定義
  var socketio = io.connect('http://localhost:8080');

  socketio.on("connected", function(name) {});
  socketio.on("publish", function (data) { addMessage(data.value); });
  socketio.on("disconnect", function () {});
  socketio.on("updateuser", function (data) {document.getElementById('usercount').innerHTML=data.value});
  // 2.イベントに絡ませる関数の定義
  function start(name) {
    socketio.emit("connected", name);
  }
  //メッセージ送信
  function publishMessage() {
    var textInput = document.getElementById('msg_input');
    var msg = "[" + myName + "] " + textInput.value;
    socketio.emit("publish", {value: msg});
    textInput.value = '';
  }
  function gamestart(){
    socketio.emit('jump_to_start');
    location.href = "./Game";

  }

  function addMessage (msg) {
    var domMeg = document.createElement('div');
    domMeg.innerHTML = new Date().toLocaleTimeString() + ' ' + msg;
    msgArea.appendChild(domMeg);
  }

  // 3.開始処理
  var msgArea = document.getElementById("msg");
  var myName = Math.floor(Math.random()*100000)
  addMessage("貴方は" + myName + "さんとして入室しました");
  start(myName);
  document.getElementById('userID').innerHTML = "募集ID:"+myName;
</script>
